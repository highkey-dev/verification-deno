import { Buffer } from "https://deno.land/std@0.173.0/node/internal/buffer.mjs";
import { VerifyCredential } from "../index.action.ts";

const verificationObj = {
    "id": "j8uGAKmNAGxJoGFedFfhBV2ZFnLGpumW7U1CuIGdI38",
    "rawId": {
        "0": 143,
        "1": 203,
        "2": 134,
        "3": 0,
        "4": 169,
        "5": 141,
        "6": 0,
        "7": 108,
        "8": 73,
        "9": 160,
        "10": 97,
        "11": 94,
        "12": 116,
        "13": 87,
        "14": 225,
        "15": 5,
        "16": 93,
        "17": 153,
        "18": 22,
        "19": 114,
        "20": 198,
        "21": 166,
        "22": 233,
        "23": 150,
        "24": 237,
        "25": 77,
        "26": 66,
        "27": 184,
        "28": 129,
        "29": 157,
        "30": 35,
        "31": 127
    },
    "type": "public-key",
    "response": {
        "authenticatorData": {
            "type": "Buffer",
            "data": [
                73,
                150,
                13,
                229,
                136,
                14,
                140,
                104,
                116,
                52,
                23,
                15,
                100,
                118,
                96,
                91,
                143,
                228,
                174,
                185,
                162,
                134,
                50,
                199,
                153,
                92,
                243,
                186,
                131,
                29,
                151,
                99,
                5,
                0,
                0,
                0,
                0
            ]
        },
        "clientDataJSON": {
            "type": "Buffer",
            "data": [
                123,
                34,
                116,
                121,
                112,
                101,
                34,
                58,
                34,
                119,
                101,
                98,
                97,
                117,
                116,
                104,
                110,
                46,
                103,
                101,
                116,
                34,
                44,
                34,
                99,
                104,
                97,
                108,
                108,
                101,
                110,
                103,
                101,
                34,
                58,
                34,
                65,
                65,
                65,
                65,
                65,
                65,
                65,
                72,
                67,
                65,
                65,
                65,
                66,
                103,
                65,
                65,
                65,
                65,
                65,
                67,
                67,
                65,
                69,
                65,
                65,
                65,
                65,
                65,
                66,
                81,
                85,
                74,
                65,
                65,
                65,
                65,
                66,
                103,
                65,
                65,
                65,
                65,
                69,
                34,
                44,
                34,
                111,
                114,
                105,
                103,
                105,
                110,
                34,
                58,
                34,
                104,
                116,
                116,
                112,
                58,
                47,
                47,
                108,
                111,
                99,
                97,
                108,
                104,
                111,
                115,
                116,
                58,
                56,
                48,
                56,
                48,
                34,
                44,
                34,
                99,
                114,
                111,
                115,
                115,
                79,
                114,
                105,
                103,
                105,
                110,
                34,
                58,
                102,
                97,
                108,
                115,
                101,
                125
            ]
        },
        "signature": {
            "type": "Buffer",
            "data": [
                48,
                70,
                2,
                33,
                0,
                195,
                20,
                41,
                242,
                140,
                127,
                104,
                77,
                134,
                254,
                181,
                16,
                156,
                181,
                199,
                212,
                228,
                146,
                11,
                242,
                38,
                141,
                145,
                24,
                12,
                215,
                245,
                129,
                72,
                204,
                208,
                91,
                2,
                33,
                0,
                204,
                198,
                73,
                185,
                144,
                81,
                127,
                50,
                171,
                31,
                91,
                135,
                210,
                40,
                77,
                226,
                143,
                209,
                85,
                126,
                68,
                172,
                204,
                220,
                246,
                180,
                211,
                234,
                16,
                139,
                114,
                103
            ]
        },
        "userHandle": {
            "type": "Buffer",
            "data": [
                48,
                120,
                53,
                56,
                51,
                57,
                56,
                57,
                100,
                70,
                65,
                51,
                102,
                67,
                68,
                51,
                52,
                65,
                97,
                53,
                101,
                53,
                65,
                55,
                49,
                57,
                69,
                57,
                51,
                56,
                97,
                51,
                65,
                55,
                51,
                49,
                49,
                53,
                53,
                65,
                100,
                99
            ]
        }
    }
  };
  let jwk: any = {
      "type": "Buffer",
      "data": [
          48,
          89,
          48,
          19,
          6,
          7,
          42,
          134,
          72,
          206,
          61,
          2,
          1,
          6,
          8,
          42,
          134,
          72,
          206,
          61,
          3,
          1,
          7,
          3,
          66,
          0,
          4,
          226,
          148,
          133,
          57,
          36,
          12,
          107,
          48,
          54,
          177,
          182,
          26,
          5,
          108,
          140,
          127,
          62,
          141,
          189,
          228,
          239,
          189,
          144,
          141,
          109,
          197,
          23,
          105,
          215,
          39,
          187,
          236,
          114,
          253,
          69,
          221,
          162,
          232,
          49,
          119,
          136,
          91,
          91,
          18,
          68,
          211,
          131,
          37,
          202,
          125,
          238,
          69,
          34,
          69,
          173,
          117,
          36,
          23,
          2,
          58,
          239,
          3,
          213,
          201
      ]
  };
  
  const pk = new Uint8Array(Buffer.from(jwk.data));
  (verificationObj.response.authenticatorData as any) = new Uint8Array(Buffer.from(verificationObj.response.authenticatorData.data));
  (verificationObj.response.clientDataJSON as any) = new Uint8Array(Buffer.from(verificationObj.response.clientDataJSON.data));
  (verificationObj.response.signature as any) =  new Uint8Array(Buffer.from(verificationObj.response.signature));
  
  const userId = "j8uGAKmNAGxJoGFedFfhBV2ZFnLGpumW7U1CuIGdI38";
  
  const res = await VerifyCredential(verificationObj, userId, pk, {});
  
  console.log(res);